version: "3.9"

# Local orchestration for Engify MCP services.
# Each service builds from a sibling directory that will be populated in later phases
# (memory service fork, guardrails server, pattern selector).
# Commands to run these services live in the Makefile.

services:
  memory:
    container_name: engify-mcp-memory
    build:
      context: ./mcp-services/memory
      dockerfile: Dockerfile
    env_file:
      - .env.memory.local
    volumes:
      - ./mcp-data/memory:/app/data
    ports:
      - "7420:7420"
    command: ["python", "-m", "mcp_memory_service.server"]
    networks:
      - engify-mcp

  guardrails:
    container_name: engify-mcp-guardrails
    build:
      context: ./mcp-services/guardrails
      dockerfile: Dockerfile
    env_file:
      - .env.guardrails.local
    depends_on:
      - memory
    ports:
      - "7421:7421"
    command: ["pnpm", "start"]
    networks:
      - engify-mcp

  patterns:
    container_name: engify-mcp-patterns
    build:
      context: ./mcp-services/patterns
      dockerfile: Dockerfile
    env_file:
      - .env.patterns.local
    depends_on:
      - memory
    ports:
      - "7422:7422"
    command: ["pnpm", "start"]
    networks:
      - engify-mcp

networks:
  engify-mcp:
    driver: bridge

volumes:
  engify-mcp-memory-data:
    driver: local
