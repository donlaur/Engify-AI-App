#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîí Running pre-commit checks..."
echo ""

# 1. Schema and code quality validation
echo "üìä Validating schema and code quality..."
node scripts/maintenance/validate-schema.js
if [ $? -ne 0 ]; then
    exit 1
fi
echo ""

# 2. Security checks
echo "üõ°Ô∏è  Checking for security issues..."
node scripts/security/security-check.js
if [ $? -ne 0 ]; then
    exit 1
fi
echo ""

# 3. Check for secrets
echo "üîç Scanning for secrets..."
if command -v git-secrets &> /dev/null; then
    git secrets --scan
    if [ $? -ne 0 ]; then
        exit 1
    fi
else
    echo "‚ö†Ô∏è  git-secrets not installed. Install with: brew install git-secrets"
fi
echo ""

# 4. Lint-staged (formatting, linting)
echo "‚ú® Running linters and formatters..."
pnpm lint-staged
if [ $? -ne 0 ]; then
    exit 1
fi
echo ""

echo "‚úÖ All pre-commit checks passed!"
echo ""
