# Lambda Container Image Dockerfile for Multi-Agent Workflow
# Based on AWS Lambda Python base image

FROM public.ecr.aws/lambda/python:3.11

# Install build dependencies (needed for tiktoken and other packages)
RUN yum install -y gcc gcc-c++ && \
    yum clean all

# Install Rust (needed for tiktoken)
RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y && \
    export PATH="$HOME/.cargo/bin:$PATH" && \
    rustc --version

# Upgrade pip first (helps get pre-built wheels)
RUN pip install --upgrade pip setuptools wheel

# Install dependencies
COPY lambda/requirements-multi-agent.txt ${LAMBDA_TASK_ROOT}/
ENV PATH="/root/.cargo/bin:${PATH}"
RUN pip install --no-cache-dir -r ${LAMBDA_TASK_ROOT}/requirements-multi-agent.txt

# Copy code
COPY lambda/agents/ ${LAMBDA_TASK_ROOT}/agents/
COPY lambda/lambda_handler_multi_agent.py ${LAMBDA_TASK_ROOT}/lambda_handler.py

# Set handler
CMD [ "lambda_handler.handler" ]

